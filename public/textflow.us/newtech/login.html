<!doctype html>
<html>
  <head>
    <meta charset="utf-8">

    <link rel="stylesheet" href="css/onsenui.css">
    <link rel="stylesheet" href="css/onsen-css-components-blue-basic-theme.css">
    <link rel="stylesheet" href="css/login.css">
    <script
    src="https://code.jquery.com/jquery-3.1.1.min.js"
    integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
    crossorigin="anonymous"></script>

    <script src="js/onsenui.js"></script>
  
  </head>
  <body>
    <ons-page>
      <ons-toolbar>
        <div class="center"><img style="padding-top:10px" src="img/logo-header.png" height="30" /></div>
      </ons-toolbar>

      <div class="login-form">

        <input id="email" type="email" class="text-input--underbar" placeholder="Email" value="">
        <input id="password" type="password" class="text-input--underbar" placeholder="Password" value="">
        <br><br>
        <ons-button id="login" modifier="large" class="login-button">Log In</ons-button>
        <br><br>
        <p>Don't have an account?</p>
        <br><br>
        <ons-button id="signup">Sign Up!</ons-button>

      </div>

    </ons-page>
    <script>
        $("document").ready(function() {
            //see if user exists
            var loggedinUser = localStorage.getItem("textflow_user")
            var user
            try {
                user = JSON.parse(loggedinUser)
            }
            catch(e) {}
            if (user && user._id) {
                location.href = "dashboard.html"
            }

            $("#signup").on("click", function() {
                location.href="signup.html"
                return false;
            })
            $("#login").on("click", function() {
                var u = $("#email").val()
                var p = $("#password").val()
                $.get("/users/login?email="+u+"&password="+p, function(result){
                    if (result._id) {
                        localStorage.setItem("textflow_user", JSON.stringify(result))
                        location.href= "dashboard.html"
                    } else {
                        alert("Incorrect username or password")
                    }
                })
            })
        })
    </script>
  </body>
</html>
